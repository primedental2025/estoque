<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Estoque - Consultório Odontológico</title>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <!-- Seu CSS aqui -->
</head>
<body>
    <div id="loginContainer" class="login-container">
        <h2>Login - Controle de Estoque</h2>
        <form id="loginForm">
            <input type="email" id="email" placeholder="E-mail" required>
            <input type="password" id="password" placeholder="Senha" required>
            <button type="submit">Entrar</button>
        </form>
    </div>
    <div id="mainContainer" class="container hidden">
        <h1>Controle de Estoque Odontológico</h1>
        <div id="materialList"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof firebase === 'undefined') {
                console.error('Firebase SDK não foi carregado corretamente.');
                alert('Erro: Firebase SDK não foi carregado. Verifique sua conexão ou tente novamente.');
                return;
            }

            const firebaseConfig = {
                apiKey: "AIzaSyCDxJW_o6y-hmisQHOHVYPVJ8cag6hrKv0",
                authDomain: "estoque-prime.firebaseapp.com",
                projectId: "estoque-prime",
                storageBucket: "estoque-prime.firebasestorage.app",
                messagingSenderId: "1092019247496",
                appId: "1:1092019247496:web:92076afda68ccbc23d823d",
                measurementId: "G-04D19CYTTQ"
            };

            const app = firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            const auth = firebase.auth();

            auth.onAuthStateChanged(user => {
                if (user) {
                    console.log('Usuário autenticado:', user);
                    document.getElementById('loginContainer').classList.add('hidden');
                    document.getElementById('mainContainer').classList.remove('hidden');
                    carregarDoServidor();
                } else {
                    document.getElementById('loginContainer').classList.remove('hidden');
                    document.getElementById('mainContainer').classList.add('hidden');
                }
            });

            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                auth.signInWithEmailAndPassword(email, password)
                    .then(() => console.log('Login bem-sucedido'))
                    .catch(error => alert('Erro ao logar: ' + error.message));
            });

            async function carregarDoServidor() {
                try {
                    const snapshot = await db.collection('estoque').doc('materiais').collection('itens').get();
                    document.getElementById('materialList').innerHTML = snapshot.docs.map(doc => `<p>${doc.data().nome}</p>`).join('');
                } catch (error) {
                    console.error('Erro ao carregar:', error);
                }
            }
        });
    </script>
</body>
</html>
